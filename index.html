<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.5.2/animate.min.css">
    <title>Project 1</title>
    <script src="https://www.gstatic.com/firebasejs/4.11.0/firebase.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/momentjs/2.12.0/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.17.0/jquery.validate.js"></script>
</head>
<style>
    /* Always set the map height explicitly to define the size of the div
         * element that contains the map. */
    #map {
        height: 50%;
        width: 90%;
        -webkit-box-shadow: 12px 29px 81px 0px rgba(0, 0, 0, 0.75);
        -moz-box-shadow: 12px 29px 81px 0px rgba(0, 0, 0, 0.75);
        box-shadow: 12px 29px 81px 0px rgba(0, 0, 0, 0.75);
        margin: 0 auto;
        margin-bottom: 15px;
    }
    /* Optional: Makes the sample page fill the window. */
    html,
    body {
        height: 100%;
        margin: 0;
        padding: 0;
        background-color: #c0c5ce;
    }
    #stupidcol {
        margin: 0px;
        padding: 0px;
    }
    #stupidrow {
        margin: 0px;
        padding: 0px;
    }
    footer {
        text-align: center;
    }
    a {
        color: black;
    }
    @font-face {
    font-family: 'Earthquake';
    src: url('EarthquakeMF.ttf') /*format('truetype');*/
    }
    h1 {
    font-family: 'Earthquake';
    font-size: 100px;
    text-align: center;
    }
</style>
</head>
<body>
    <div id="map" class="animated"></div>
    <body>
        <div class="container">
            <h1 class="text-center"><strong>Seismic Stats</strong></h1>
            <h3 class="text-center"><a href="https://www.youtube.com/watch?v=XImPJl_mQOQ&t">Because Superman Won't Save You</a></h3>
            <div class="row" id="stupidrow">
                <div class="panel panel-primary">
                    <div class="panel-heading">
                        <h3 class="panel-title">
                            <strong>Add Address</strong>
                        </h3>
                    </div>
                    <div class="panel-body">
                        <form>
                            <table class="table">
                                <div class="row">
                                    <div class="col-lg-4">
                                        <div class="form-group">
                                            <label class="control-label" for="street_address">Street Address</label>
                                            <div class="input-group">
                                                <input class="form-control" placeholder="" name="street_address" type="text" id="street_address" />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-4">
                                        <div class="form-group">
                                            <label class="control-label" for="city_input">City</label>
                                            <div class="input-group">
                                                <input class="form-control" placeholder="" name="city_input" type="text" id="city_input" />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-4">
                                        <div class="form-group">
                                            <label class="control-label" for="state_input">State</label>
                                            <div class="input-group">
                                                <input class="form-control" placeholder="" name="state_input" type="text" id="state_input" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </table>
                            <button type="submit" class="btn btn-primary">Submit</button>
                        </form>
                    </div>
                </div>
            </div>
            <div class="col-lg-12" id="stupidcol">
                <div class="panel panel-primary">
                    <div class="panel-heading">
                        <h3 class="panel-title">
                            <strong>Address Information</strong>
                        </h3>
                    </div>
                    <div class="panel-body">
                        <table class="table table-hover" id='quake-table'>
                            <thead>
                                <tr>
                                    <th>Street Address</th>
                                    <th>City</th>
                                    <th>State</th>
                                </tr>
                            </thead>
                            <tbody id="addresses">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="col-lg-12" id="stupidcol">
                <div class="panel panel-primary">
                    <div class="panel-heading">
                        <h3 class="panel-title">
                            <strong>Earthquake Information</strong>
                        </h3>
                    </div>
                    <div class="panel-body">
                        <table class="table table-hover" id='quake-table'>
                            <thead>
                                <tr>
                                    <th>Place</th>
                                    <th>Time</th>
                                    <th>Magnitude</th>
                                </tr>
                            </thead>
                            <tbody id="history">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        </div>
        </div>
        <script>
            var map;
            function initMap() {
                map = new google.maps.Map(document.getElementById('map'), {
                    zoom: 8,
                    center: { lat: 40.7608, lng: -111.8910 },
                    mapTypeId: 'terrain'
                });
                // Create a <script> tag and set the USGS URL as the source.
                var script = document.createElement('script');
                // This example uses a local copy of the GeoJSON stored at
                //http://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/2.5_week.geojsonp
                // script.src = 'fakedata.js';
                document.getElementsByTagName('head')[0].appendChild(script);
                map.data.setStyle(function (feature) {
                    var magnitude = feature.getProperty('mag');
                    var place = feature.getProperty('place');
                    var time = feature.getProperty('time');
                    var ctime = moment(time).format();
                    $('#history').append("<tr><td>" + place + "</td><td>" + ctime + "</td><td>" + magnitude + "</td><td>");
                    return {
                        icon: getCircle(magnitude)
                    };
                });
            }
            function getCircle(magnitude) {
                return {
                    path: google.maps.SymbolPath.CIRCLE,
                    fillColor: 'brown',
                    fillOpacity: 1,
                    scale: Math.pow(2, magnitude) / 2,
                    strokeColor: 'white',
                    strokeWeight: .5
                };
            }
            function eqfeed_callback(results) {
                map.data.addGeoJson(results);
            }
            var config = {
                apiKey: "AIzaSyBufRELsSOVSrguYEl3zMS_yDbjg6XVLos",
                authDomain: "project1-1520099791989.firebaseapp.com",
                databaseURL: "https://project1-1520099791989.firebaseio.com",
                projectId: "project1-1520099791989",
                storageBucket: "",
                messagingSenderId: "778829038115"
            };
            firebase.initializeApp(config);
            var database = firebase.database();
            $(".btn").on("click", function (event) {
                event.preventDefault();
                $('form').valid();
                $("#history").empty();
                $("#map").addClass("shake").one("webkitAnimationEnd mozAnimationEnd oAnimationEnd animationend", function () {
                    $(this).removeClass("shake");
                })
                var streetAdd = $("#street_address").val().trim();
                var street1 = streetAdd.split(' ').join('+');
                var cityAdd = $("#city_input").val().trim();
                var city1 = cityAdd.split(' ').join('+');
                var stateAdd = $("#state_input").val().trim();
                $("#street_address").val("");
                $("#city_input").val("");
                $("#state_input").val("");
                database.ref().push({
                    street: streetAdd,
                    city: cityAdd,
                    state: stateAdd
                });
                var queryURL = "https://maps.googleapis.com/maps/api/geocode/json?address=" + street1 + ",+" + city1 + ",+" + stateAdd + "&key=AIzaSyBRnBbZdpThRUpOF47JaGuMIrKZMt38SSU";
                $.ajax({
                    url: queryURL,
                    method: "GET"
                }).then(function (response) {
                    console.log(response);
                    var lat = (response.results[0].geometry.location.lat);
                    var lng = (response.results[0].geometry.location.lng);
                    //recenter the map (note: requires object)
                    map.setCenter({ lat: lat, lng: lng });
                    var queryURL2 = "https://earthquake.usgs.gov/fdsnws/event/1/query?format=geojson&starttime=2013-01-01&endtime=&latitude=" + lat + "&longitude=" + lng + "&maxradiuskm=20"
                    $.ajax({
                        url: queryURL2,
                        method: "GET"
                    }).then(function (response) {
                        eqfeed_callback(response);
                        console.log(response);
                    })
                });
                $("#addresses").append("<tr><td>" + streetAdd + "</td><td>" + cityAdd + "</td><td>" + stateAdd + "</td><tr>");
            });
            $('form').validate({
                rules: {
                    city_input: {
                        required: true
                    },
                    state_input: {
                        required: true
                    },
                },
                highlight: function (element) {
                    $(element).closest('.form-group').addClass('has-error');
                },
                unhighlight: function (element) {
                    $(element).closest('.form-group').removeClass('has-error');
                },
                errorElement: 'span',
                errorClass: 'help-block',
                errorPlacement: function (error, element) {
                    if (element.parent('.input-group').length) {
                        error.insertAfter(element.parent());
                    } else {
                        error.insertAfter(element);
                    }
                }
            });
            
        </script>
        <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCBacf-yGvhzUPn4NA8QQrUHcX_4FG5yNM&content_copy&callback=initMap">
        </script>
        <footer>© groupName 2018</footer>
    </body>
</html>
